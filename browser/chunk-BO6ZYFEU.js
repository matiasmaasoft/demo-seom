import{b as S}from"./chunk-ZW73QO2R.js";import{a as u,b as f,ja as p,k as m,t as d,za as l}from"./chunk-PBFQ7HWZ.js";var C=class s{listSignal=d(this.load());listado=this.listSignal.asReadonly();load(){try{let t=localStorage.getItem(l.CONSUMOS);return t?JSON.parse(t):[]}catch{return[]}}save(t){localStorage.setItem(l.CONSUMOS,JSON.stringify(t)),this.listSignal.set(t)}registrar(t){let e=this.listSignal(),o="con-"+Date.now(),r=String(Date.now()).padStart(22,"0"),i=f(u({},t),{id:o,fecha:S,codigoTransaccion:r}),n=[...e,i];return this.save(n),i}listarPorSocio(t){return this.listSignal().filter(e=>e.socioId===t)}listarPorComercio(t){return this.listSignal().filter(e=>e.comercioId===t)}totalPorComercio(t){return this.listarPorComercio(t).reduce((e,o)=>e+o.monto,0)}getConsumosMensualesPorSocio(t){let e=this.listarPorSocio(t),o=new Map;return e.forEach(r=>{let i=r.fecha.slice(0,7);o.set(i,(o.get(i)??0)+r.monto)}),Array.from(o.entries()).map(([r,i])=>({mes:r,total:i})).sort((r,i)=>r.mes.localeCompare(i.mes))}static \u0275fac=function(e){return new(e||s)};static \u0275prov=m({token:s,factory:s.\u0275fac,providedIn:"root"})};function h(s){let t=s.split(/\r?\n/),e=[],o="",r=0;for(let i of t){let n=i.split("	").map(a=>a.trim()),g=n[0]||"",c=n[1]||"",y=n[2]||"",R=n[3]||"";if(n.filter(Boolean).length<=2){let a=c||g;if(a&&a===a.toUpperCase()&&a.length>2){o=a;continue}}n.length>=3&&c&&(r+=1,e.push({id:"com-real-"+r,nombre:c,direccion:y||void 0,telefono:R||void 0,categoria:o||void 0}))}return e}var O="lista_comercios.txt",v=12,E=class s{listSignal=d(this.load());listRealSignal=d([]);loadedReal=!1;listado=this.listSignal.asReadonly();listReal=this.listRealSignal.asReadonly();listaParaBusqueda=p(()=>[...this.listRealSignal()]);load(){try{let t=localStorage.getItem(l.COMERCIOS);return t?JSON.parse(t):[]}catch{return[]}}save(t){localStorage.setItem(l.COMERCIOS,JSON.stringify(t)),this.listSignal.set(t)}async loadListaReal(){if(!this.loadedReal)try{let t=await fetch(O);if(!t.ok)return;let e=await t.text(),o=h(e);this.listRealSignal.set(o),this.loadedReal=!0}catch{}}searchComercios(t){let e=this.listaParaBusqueda();if(!t||t.length<2)return e.slice(0,v);let o=this.normalize(t);return e.filter(i=>{let n=this.normalize(i.nombre),g="categoria"in i&&i.categoria?this.normalize(i.categoria):"",c="direccion"in i&&i.direccion?this.normalize(i.direccion):"";return n.includes(o)||g.includes(o)||c.includes(o)}).slice(0,v)}normalize(t){return t.toLowerCase().normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").trim()}getById(t){let e=this.listSignal().find(o=>o.id===t);return e||this.listRealSignal().find(o=>o.id===t)}getAll(){return[...this.listSignal(),...this.listRealSignal()]}static \u0275fac=function(e){return new(e||s)};static \u0275prov=m({token:s,factory:s.\u0275fac,providedIn:"root"})};export{C as a,E as b};
