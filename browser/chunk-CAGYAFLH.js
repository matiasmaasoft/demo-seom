import{a as E,b as S,c as K,d as W,e as k,f as X,g as Z,h as ee,i as oe,j as I}from"./chunk-EJVLHODW.js";import{a as te}from"./chunk-NGP3UDIS.js";import{a as ne}from"./chunk-XIVB7M67.js";import{a as ie}from"./chunk-23TUAAVS.js";import{a as J}from"./chunk-BPT5JHIB.js";import{b as O}from"./chunk-BO6ZYFEU.js";import"./chunk-ZW73QO2R.js";import{C as x,H as V,I as u,J as g,K as L,L as z,M as _,N as n,O as r,P as q,T as M,U as C,V as m,W as F,X as R,Y as B,_ as D,aa as c,ba as y,ca as v,ea as j,ha as Q,ia as $,ja as f,ka as H,la as N,o as s,p as h,pa as G,q as b,qa as w,t as p,u as A,va as U,wa as Y,y as T,z as a}from"./chunk-PBFQ7HWZ.js";var se=["inputRef"],de=(t,o)=>o.id;function pe(t,o){if(t&1){let e=M();n(0,"button",8),C("click",function(l){return h(e),m().clear(),b(l.stopPropagation())}),c(1," \xD7 "),r()}}function ue(t,o){t&1&&(n(0,"p",6),c(1,"Cargando lista de comercios..."),r())}function ge(t,o){if(t&1&&c(0),t&2){let e=m(3);v(' No se encontraron comercios para "',e.query(),'" ')}}function Ce(t,o){t&1&&c(0," Escrib\xED al menos 2 letras para buscar ")}function fe(t,o){if(t&1&&(n(0,"div",9),u(1,ge,1,1)(2,Ce,1,0),r()),t&2){let e=m(2);a(),g(e.query().length>=2?1:2)}}function _e(t,o){if(t&1&&(n(0,"span",13),c(1),r()),t&2){let e=m().$implicit;a(),j(" ",e.categoria,"",e.categoria&&e.direccion?" \xB7 ":"","",e.direccion??""," ")}}function he(t,o){if(t&1){let e=M();n(0,"button",11),C("click",function(){let l=h(e).$implicit,d=m(3);return b(d.select(l))}),n(1,"span",12),c(2),r(),u(3,_e,2,3,"span",13),r()}if(t&2){let e=o.$implicit,i=m(3);D("selected",i.selectedId()===e.id),a(2),y(e.nombre),a(),g(i.isExtended(e)&&(e.categoria||e.direccion)?3:-1)}}function be(t,o){if(t&1&&L(0,he,4,4,"button",10,de),t&2){let e=m(2);z(e.results())}}function ve(t,o){if(t&1&&(n(0,"div",7),u(1,fe,3,1,"div",9)(2,be,2,0),r()),t&2){let e=m();a(),g(e.results().length===0?1:2)}}var P=class t{comercios=s(O);el=s(T);inputRef;selectedId=N("");placeholder=N("Buscar comercio por nombre, categor\xEDa o direcci\xF3n...");selectionChange=H();query=p("");open=p(!1);loading=p(!0);clickOutsideListener=null;results=f(()=>this.comercios.searchComercios(this.query()));selectedComercio=f(()=>{let o=this.selectedId();return o?this.comercios.getById(o):null});displayValue=f(()=>{let o=this.selectedComercio();return o?o.nombre:this.query()});constructor(){A(()=>{let o=this.selectedId();if(o){let e=this.comercios.getById(o);this.query.set(e?.nombre??"")}})}ngAfterViewInit(){this.comercios.loadListaReal().then(()=>this.loading.set(!1)),this.clickOutsideListener=o=>{let e=this.el.nativeElement;e&&!e.contains(o.target)&&this.open.set(!1)},setTimeout(()=>document.addEventListener("mousedown",this.clickOutsideListener),0)}ngOnDestroy(){this.clickOutsideListener&&document.removeEventListener("mousedown",this.clickOutsideListener)}onInput(){this.open.set(!0)}onFocus(){this.open.set(!0)}select(o){this.query.set(o.nombre),this.open.set(!1),this.selectionChange.emit(o)}clear(){this.query.set(""),this.selectionChange.emit(null),this.inputRef?.nativeElement?.focus()}isExtended(o){return"categoria"in o||"direccion"in o}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=x({type:t,selectors:[["app-comercio-autocomplete"]],viewQuery:function(e,i){if(e&1&&F(se,5),e&2){let l;R(l=B())&&(i.inputRef=l.first)}},inputs:{selectedId:[1,"selectedId"],placeholder:[1,"placeholder"]},outputs:{selectionChange:"selectionChange"},decls:8,vars:11,consts:[["inputRef",""],[1,"autocomplete-wrap"],[1,"input-wrapper"],["aria-hidden","true",1,"icon-search"],["type","text","autocomplete","off","role","combobox","aria-label","Buscar comercio",1,"input",3,"ngModelChange","focus","placeholder","ngModel"],["type","button","aria-label","Limpiar",1,"btn-clear"],[1,"hint","loading"],["role","listbox",1,"dropdown"],["type","button","aria-label","Limpiar",1,"btn-clear",3,"click"],[1,"dropdown-empty"],["type","button","role","option",1,"dropdown-item",3,"selected"],["type","button","role","option",1,"dropdown-item",3,"click"],[1,"item-name"],[1,"item-meta"]],template:function(e,i){if(e&1){let l=M();n(0,"div",1)(1,"div",2),q(2,"span",3),n(3,"input",4,0),C("ngModelChange",function(ae){return h(l),i.query.set(ae),b(i.onInput())})("focus",function(){return h(l),b(i.onFocus())}),r(),u(5,pe,2,0,"button",5),r(),u(6,ue,2,0,"p",6),u(7,ve,3,1,"div",7),r()}e&2&&(a(),D("focused",i.open())("has-value",i.selectedComercio()),a(2),_("placeholder",i.placeholder())("ngModel",i.query()),V("aria-expanded",i.open())("aria-haspopup","listbox"),a(2),g(i.selectedComercio()?5:-1),a(),g(i.loading()?6:-1),a(),g(i.open()&&!i.loading()?7:-1))},dependencies:[w,I,E,S,k],styles:[`.autocomplete-wrap[_ngcontent-%COMP%]{position:relative;width:100%}.input-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;gap:.5rem;padding:0 1rem 0 2.75rem;min-height:48px;border:1px solid var(--seom-border);border-radius:var(--seom-radius-sm);background:var(--seom-card-bg);transition:border-color .2s,box-shadow .2s}.input-wrapper.focused[_ngcontent-%COMP%]{border-color:var(--seom-primary-light);box-shadow:0 0 0 3px #e85d0426}.input-wrapper.has-value[_ngcontent-%COMP%]{border-color:var(--seom-accent-green)}.icon-search[_ngcontent-%COMP%]{position:absolute;left:1rem;top:50%;transform:translateY(-50%);width:1.125rem;height:1.125rem;opacity:.5;pointer-events:none;background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236c757d'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z'/%3E%3C/svg%3E") center/contain no-repeat}.input[_ngcontent-%COMP%]{flex:1;min-width:0;border:none;background:none;font-size:1rem;padding:.75rem 0;outline:none}.input[_ngcontent-%COMP%]::placeholder{color:var(--seom-text-muted)}.btn-clear[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:28px;height:28px;border-radius:50%;font-size:1.25rem;line-height:1;color:var(--seom-text-muted);background:var(--seom-bg);transition:color .2s,background .2s}.btn-clear[_ngcontent-%COMP%]:hover{color:var(--seom-text);background:var(--seom-border)}.hint.loading[_ngcontent-%COMP%]{font-size:.8125rem;color:var(--seom-text-muted);margin:.5rem 0 0;padding:0 .25rem}.dropdown[_ngcontent-%COMP%]{position:absolute;top:calc(100% + 4px);left:0;right:0;max-height:280px;overflow-y:auto;background:var(--seom-card-bg);border-radius:var(--seom-radius-sm);box-shadow:0 8px 24px #0000001f;border:1px solid var(--seom-border);z-index:100;padding:.25rem 0}.dropdown-empty[_ngcontent-%COMP%]{padding:1rem;font-size:.875rem;color:var(--seom-text-muted);text-align:center}.dropdown-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-start;gap:.2rem;width:100%;padding:.75rem 1rem;border:none;background:none;text-align:left;font-family:inherit;cursor:pointer;transition:background .15s;border-radius:0}.dropdown-item[_ngcontent-%COMP%]:hover{background:var(--seom-bg)}.dropdown-item.selected[_ngcontent-%COMP%]{background:#e85d0414}.item-name[_ngcontent-%COMP%]{font-weight:600;font-size:.9375rem;color:var(--seom-text)}.item-meta[_ngcontent-%COMP%]{font-size:.75rem;color:var(--seom-text-muted);line-height:1.3;max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}`]})};function xe(t,o){if(t&1&&(n(0,"p",10),c(1),r()),t&2){let e=m();a(),y(e.error())}}var re=class t{auth=s(J);solicitudes=s(ie);comercios=s(O);limite=s(te);snackbar=s(ne);router=s(U);socioId=f(()=>this.auth.getUsuarioActual()?.id??"");disponible=f(()=>this.limite.disponible(this.socioId()));comercioId=p("");monto=p(null);loading=p(!1);error=p("");onComercioSelect(o){this.comercioId.set(o?.id??"")}onSubmit(){this.error.set("");let o=this.comercioId(),e=this.monto();if(!o){this.error.set("Seleccione un comercio.");return}if(e==null||e<=0){this.error.set("Ingrese un monto v\xE1lido.");return}if(e>this.disponible()){this.error.set("El monto supera su l\xEDmite disponible.");return}this.loading.set(!0);let i=this.solicitudes.crear({socioId:this.socioId(),comercioId:o,monto:e});this.snackbar.show("Solicitud enviada",2500),setTimeout(()=>{this.solicitudes.aprobar(i.id),this.snackbar.show("Solicitud aprobada",3e3),this.loading.set(!1),this.router.navigate(["/socio","pagar",i.id])},2500)}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=x({type:t,selectors:[["app-solicitar-consumo"]],decls:20,vars:10,consts:[[1,"app-container"],["routerLink","/socio",1,"back-link"],[1,"page-title"],[1,"page-subtitle"],[1,"form",3,"ngSubmit"],["for","comercio",1,"label"],["id","comercio","placeholder","Buscar por nombre, categor\xEDa o direcci\xF3n...",3,"selectionChange","selectedId"],["for","monto",1,"label"],["id","monto","type","number","placeholder","0","min","1","name","monto",1,"input",3,"ngModelChange","max","ngModel"],[1,"hint"],["role","alert",1,"error-msg"],["type","submit",1,"btn-primary","btn-submit",3,"disabled"]],template:function(e,i){e&1&&(n(0,"div",0)(1,"a",1),c(2,"\u2190 Volver al inicio"),r(),n(3,"h1",2),c(4,"Solicitar consumo"),r(),n(5,"p",3),c(6,"Elija comercio y monto. La aprobaci\xF3n es autom\xE1tica en esta demo."),r(),n(7,"form",4),C("ngSubmit",function(){return i.onSubmit()}),n(8,"label",5),c(9,"Comercio"),r(),n(10,"app-comercio-autocomplete",6),C("selectionChange",function(d){return i.onComercioSelect(d)}),r(),n(11,"label",7),c(12,"Monto solicitado"),r(),n(13,"input",8),C("ngModelChange",function(d){return i.monto.set(d===""?null:+d)}),r(),n(14,"p",9),c(15),Q(16,"number"),r(),u(17,xe,2,1,"p",10),n(18,"button",11),c(19),r()()()),e&2&&(a(10),_("selectedId",i.comercioId()),a(3),_("max",i.disponible())("ngModel",i.monto()),a(2),v("Disponible: ",$(16,7,i.disponible(),"1.2-2")," ARS"),a(2),g(i.error()?17:-1),a(),_("disabled",i.loading()),a(),v(" ",i.loading()?"Enviando...":"Enviar solicitud"," "))},dependencies:[w,I,X,E,Z,S,K,oe,ee,k,W,Y,P,G],styles:[".back-link[_ngcontent-%COMP%]{display:inline-block;font-size:.875rem;font-weight:600;color:var(--seom-primary);margin-bottom:1rem;text-decoration:none}.back-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.page-title[_ngcontent-%COMP%]{font-size:1.375rem;margin-bottom:.25rem}.page-subtitle[_ngcontent-%COMP%]{font-size:.875rem;color:var(--seom-text-muted);margin-bottom:1.5rem}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem}.label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:var(--seom-text)}.input[_ngcontent-%COMP%]{width:100%;padding:.875rem 1rem;border:1px solid var(--seom-border);border-radius:var(--seom-radius-sm);font-size:1rem}.input[_ngcontent-%COMP%]:focus{outline:none;border-color:var(--seom-primary-light);box-shadow:0 0 0 3px #e85d0433}.select[_ngcontent-%COMP%]{appearance:auto;cursor:pointer}.hint[_ngcontent-%COMP%]{font-size:.8125rem;color:var(--seom-text-muted);margin:-.5rem 0 0}.error-msg[_ngcontent-%COMP%]{font-size:.875rem;color:var(--seom-danger);margin:0}.btn-submit[_ngcontent-%COMP%]{margin-top:.75rem;padding:1rem .875rem;min-height:48px;width:auto;min-width:200px;align-self:center}"]})};export{re as SolicitarConsumoComponent};
